{% extends "base.html" %}

{% block title %}API Reference - DigitalSkeleton{% endblock %}

{% block content %}
<div class="container">
    <div class="row justify-content-center">
        <div class="col-lg-10">
            <!-- Header -->
            <div class="hero-section text-center p-4 mb-5">
                <div class="hero-icon mb-3">
                    <div class="d-inline-flex align-items-center justify-content-center" style="width: 60px; height: 60px; background: var(--primary-gradient); border-radius: 50%;">
                        <i class="fas fa-code text-white fa-lg"></i>
                    </div>
                </div>
                <h1 class="display-5 fw-bold mb-3">API Reference</h1>
                <p class="lead" style="color: #666;">Complete API documentation for DigitalSkeleton</p>
            </div>

            <!-- Base URL -->
            <div class="card mb-5">
                <div class="card-header">
                    <h3 class="mb-0"><i class="fas fa-server me-2"></i>Base URL</h3>
                </div>
                <div class="card-body">
                    <p>All API requests should be made to:</p>
                    <div class="bg-light p-3 rounded">
                        <code>https://your-domain.com/api/</code>
                    </div>
                </div>
            </div>

            <!-- Authentication -->
            <div class="card mb-5">
                <div class="card-header">
                    <h3 class="mb-0"><i class="fas fa-key me-2"></i>Authentication</h3>
                </div>
                <div class="card-body">
                    <p>Currently, DigitalSkeleton operates without authentication for public use. For enterprise deployments, consider implementing API keys:</p>
                    <div class="bg-light p-3 rounded">
                        <code>Authorization: Bearer YOUR_API_KEY</code>
                    </div>
                </div>
            </div>

            <!-- Endpoints -->
            <div class="card mb-5">
                <div class="card-header">
                    <h3 class="mb-0"><i class="fas fa-link me-2"></i>Endpoints</h3>
                </div>
                <div class="card-body">
                    
                    <!-- Analyze Endpoint -->
                    <div class="mb-5">
                        <h4 class="text-primary">POST /analyze</h4>
                        <p>Analyze a website's PWA readiness and return comprehensive assessment.</p>
                        
                        <h6>Request Body:</h6>
                        <pre class="bg-light p-3 rounded"><code>{
  "url": "https://example.com"
}</code></pre>

                        <h6>Response:</h6>
                        <pre class="bg-light p-3 rounded"><code>{
  "metadata": {
    "title": "Example Website",
    "description": "Website description",
    "icon_url": "https://example.com/icon.png",
    "theme_color": "#000000"
  },
  "pwa_assessment": {
    "is_pwa_ready": false,
    "pwa_score": 65,
    "checks": {
      "https": {
        "passed": true,
        "details": "Website uses HTTPS"
      },
      "manifest": {
        "passed": false,
        "details": "No web app manifest found"
      },
      "service_worker": {
        "passed": false,
        "details": "No service worker detected"
      }
    },
    "recommendations": [
      {
        "title": "Add Web App Manifest",
        "description": "Create a manifest.json file",
        "action": "Add manifest with required fields",
        "priority": "high"
      }
    ]
  }
}</code></pre>

                        <h6>HTTP Status Codes:</h6>
                        <ul>
                            <li><code>200</code> - Success</li>
                            <li><code>400</code> - Invalid URL format</li>
                            <li><code>500</code> - Analysis failed</li>
                        </ul>
                    </div>

                    <!-- Build Endpoint -->
                    <div class="mb-5">
                        <h4 class="text-primary">POST /build</h4>
                        <p>Generate app package for specified platform.</p>
                        
                        <h6>Request Body:</h6>
                        <pre class="bg-light p-3 rounded"><code>{
  "url": "https://example.com",
  "package_type": "apk"
}</code></pre>

                        <h6>Package Types:</h6>
                        <ul>
                            <li><code>apk</code> - Android Studio project</li>
                            <li><code>ipa</code> - Xcode project</li>
                            <li><code>msix</code> - Visual Studio project</li>
                            <li><code>appx</code> - UWP project</li>
                        </ul>

                        <h6>Response:</h6>
                        <pre class="bg-light p-3 rounded"><code>{
  "job_id": "550e8400-e29b-41d4-a716-446655440000",
  "status": "pending",
  "package_type": "apk",
  "progress_url": "/progress/550e8400-e29b-41d4-a716-446655440000"
}</code></pre>
                    </div>

                    <!-- Progress Endpoint -->
                    <div class="mb-5">
                        <h4 class="text-primary">GET /progress/{job_id}</h4>
                        <p>Check build progress and get download link when ready.</p>
                        
                        <h6>Response (In Progress):</h6>
                        <pre class="bg-light p-3 rounded"><code>{
  "job_id": "550e8400-e29b-41d4-a716-446655440000",
  "status": "processing",
  "progress": 45,
  "message": "Generating Android project files..."
}</code></pre>

                        <h6>Response (Completed):</h6>
                        <pre class="bg-light p-3 rounded"><code>{
  "job_id": "550e8400-e29b-41d4-a716-446655440000",
  "status": "completed",
  "progress": 100,
  "download_url": "/download/550e8400-e29b-41d4-a716-446655440000",
  "filename": "ExampleApp_android_project.zip",
  "file_size": "2.4 MB"
}</code></pre>
                    </div>

                    <!-- Download Endpoint -->
                    <div class="mb-5">
                        <h4 class="text-primary">GET /download/{job_id}</h4>
                        <p>Download the generated app package.</p>
                        
                        <h6>Response:</h6>
                        <p>Binary file download with appropriate content headers.</p>
                        <ul>
                            <li><code>Content-Type: application/zip</code></li>
                            <li><code>Content-Disposition: attachment; filename="project.zip"</code></li>
                        </ul>
                    </div>

                    <!-- PWA Generation Endpoint -->
                    <div class="mb-5">
                        <h4 class="text-primary">POST /generate-pwa</h4>
                        <p>Generate PWA files and setup instructions for non-PWA websites.</p>
                        
                        <h6>Request Body:</h6>
                        <pre class="bg-light p-3 rounded"><code>{
  "url": "https://example.com"
}</code></pre>

                        <h6>Response:</h6>
                        <pre class="bg-light p-3 rounded"><code>{
  "job_id": "660e8400-e29b-41d4-a716-446655440001",
  "pwa_files": {
    "manifest.json": "{ \"name\": \"Example App\", ... }",
    "sw.js": "// Service Worker code...",
    "index.html": "<!-- Updated HTML with PWA meta tags -->"
  },
  "instructions": [
    "Upload manifest.json to your website root",
    "Upload sw.js to your website root",
    "Add meta tags to your HTML head section"
  ]
}</code></pre>
                    </div>
                </div>
            </div>

            <!-- Error Handling -->
            <div class="card mb-5">
                <div class="card-header">
                    <h3 class="mb-0"><i class="fas fa-exclamation-triangle me-2"></i>Error Handling</h3>
                </div>
                <div class="card-body">
                    <p>All API errors return a consistent format:</p>
                    <pre class="bg-light p-3 rounded"><code>{
  "error": "Error message description",
  "code": "ERROR_CODE",
  "details": {
    "field": "Additional error context"
  }
}</code></pre>

                    <h6>Common Error Codes:</h6>
                    <ul>
                        <li><code>INVALID_URL</code> - URL format is invalid</li>
                        <li><code>UNREACHABLE_URL</code> - Website cannot be accessed</li>
                        <li><code>UNSUPPORTED_PACKAGE_TYPE</code> - Invalid package type</li>
                        <li><code>BUILD_FAILED</code> - Package generation failed</li>
                        <li><code>JOB_NOT_FOUND</code> - Invalid job ID</li>
                    </ul>
                </div>
            </div>

            <!-- Rate Limits -->
            <div class="card mb-5">
                <div class="card-header">
                    <h3 class="mb-0"><i class="fas fa-tachometer-alt me-2"></i>Rate Limits</h3>
                </div>
                <div class="card-body">
                    <p>Current rate limits for public use:</p>
                    <ul>
                        <li><strong>Analysis:</strong> 10 requests per minute</li>
                        <li><strong>Build:</strong> 5 requests per minute</li>
                        <li><strong>Download:</strong> No limit</li>
                    </ul>
                    <p>Rate limit headers are included in responses:</p>
                    <pre class="bg-light p-3 rounded"><code>X-RateLimit-Limit: 10
X-RateLimit-Remaining: 8
X-RateLimit-Reset: 1640995200</code></pre>
                </div>
            </div>

            <!-- SDK Examples -->
            <div class="card mb-5">
                <div class="card-header">
                    <h3 class="mb-0"><i class="fas fa-code-branch me-2"></i>SDK Examples</h3>
                </div>
                <div class="card-body">
                    <div class="row">
                        <div class="col-md-6">
                            <h6>JavaScript/Node.js</h6>
                            <pre class="bg-light p-3 rounded"><code>const response = await fetch('/analyze', {
  method: 'POST',
  headers: {
    'Content-Type': 'application/json'
  },
  body: JSON.stringify({
    url: 'https://example.com'
  })
});

const data = await response.json();
console.log(data.pwa_assessment);</code></pre>
                        </div>
                        <div class="col-md-6">
                            <h6>Python</h6>
                            <pre class="bg-light p-3 rounded"><code>import requests

response = requests.post('/analyze', json={
    'url': 'https://example.com'
})

data = response.json()
print(data['pwa_assessment'])</code></pre>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>
{% endblock %}