{% extends "base.html" %}

{% block title %}Flutterwave Payment - CourseHub{% endblock %}

{% block content %}
<h1>Pay with Flutterwave</h1>

<div class="card">
    <div class="card-body">
        <h5>Course: {{ course.title }}</h5>
        <h3>Amount: {{ currency }} {{ "%.2f"|format(amount) }}</h3>
        
        <button onclick="makePayment()" class="btn btn-success btn-lg">
            <i class="bi bi-credit-card"></i> Pay Now
        </button>
    </div>
</div>
{% endblock %}

{% block scripts %}
<script src="https://checkout.flutterwave.com/v3.js"></script>
<script>
function makePayment() {
    FlutterwaveCheckout({
        public_key: "{{ public_key }}",
        tx_ref: "{{ reference }}",
        amount: {{ amount }},
        currency: "{{ currency }}",
        payment_options: "card,mobilemoney,ussd",
        customer: {
            email: "{{ email }}",
            name: "{{ customer_name }}"
        },
        customizations: {
            title: "{{ course.title }}",
            description: "Course Purchase",
            logo: "https://via.placeholder.com/150"
        },
        callback: function (data) {
            if (data.status === "successful") {
                window.location.href = "{{ url_for('payments.flutterwave_callback') }}?transaction_id=" + data.transaction_id;
            }
        },
        onclose: function() {
            alert('Payment cancelled');
        }
    });
}
</script>
{% endblock %}
